# =============================================================================
# HomeLab SOC v2 - Environment Variables
# =============================================================================
#
# Purpose:  Configuration for SOC automation, enrichment, and alerting
# Location: /share/Container/soc-automation/.env (production)
#           scripts/soc-automation/.env (development)
#
# Setup:    Copy this file to .env and fill in your values
#           chmod 600 .env (restrict permissions)
#
# =============================================================================


# =============================================================================
# OPENSEARCH - SIEM BACKEND
# =============================================================================
# OpenSearch cluster connection for log storage and threat intelligence
#
# Host Options:
#   - Local VLAN:   10.10.20.10 (from VLAN 20/30 devices)
#   - Tailscale:    <qnap-tailscale-ip> (from remote/GCP)
#   - Localhost:    localhost (if running on QNAP directly)
#
OPENSEARCH_HOST=<qnap-tailscale-ip>
OPENSEARCH_PORT=9200

# OpenSearch admin credentials
# Password requirements: Min 8 chars, uppercase, lowercase, number, special char
OPENSEARCH_USER=admin
OPENSEARCH_PASS=your_opensearch_password_here


# =============================================================================
# ABUSEIPDB - THREAT INTELLIGENCE
# =============================================================================
# IP reputation lookups for visitor threat scoring
#
# Get your free API key at: https://www.abuseipdb.com/account/api
#
# Rate Limits:
#   - Free tier:  1,000 checks/day
#   - Basic:      10,000 checks/day
#   - Premium:    100,000 checks/day
#
# The enrichment script respects these limits and caches results for 24 hours
#
ABUSEIPDB_KEY=your_abuseipdb_api_key_here


# =============================================================================
# CLOUDFLARE - AUTO-BLOCKING & EDGE SECURITY
# =============================================================================
# Automated IP blocking at Cloudflare edge for confirmed threats
#
# Create API Token at: https://dash.cloudflare.com/profile/api-tokens
#
# Required Token Permissions:
#   - Account > Account Firewall Access Rules > Edit
#   - Zone > Firewall Services > Edit (if using zone-level rules)
#
# Find your Account ID:
#   - Cloudflare Dashboard > any domain > Overview > right sidebar
#
# Find your Zone ID (if needed):
#   - Cloudflare Dashboard > domain > Overview > right sidebar
#
CLOUDFLARE_API_TOKEN=your_cloudflare_api_token_here
CLOUDFLARE_ACCOUNT_ID=your_cloudflare_account_id_here
CLOUDFLARE_ZONE_ID=your_zone_id_here


# =============================================================================
# DISCORD - REAL-TIME ALERTING
# =============================================================================
# Webhook for SOC alerts, threat notifications, and watch turnover reports
#
# Create webhook:
#   1. Open Discord server
#   2. Server Settings → Integrations → Webhooks
#   3. New Webhook → Copy URL
#
# Recommended: Create dedicated #soc-alerts channel
#
DISCORD_WEBHOOK=https://discord.com/api/webhooks/your_webhook_id/your_webhook_token


# =============================================================================
# EMAIL - ALERTING (OPTIONAL)
# =============================================================================
# SMTP configuration for email alerts (backup to Discord)
#
# Gmail Setup:
#   1. Enable 2FA on Google account
#   2. Generate App Password: Google Account → Security → App Passwords
#   3. Use app password below (not your regular password)
#
# Other providers: Adjust SMTP_HOST and SMTP_PORT accordingly
#   - Outlook:    smtp.office365.com:587
#   - SendGrid:   smtp.sendgrid.net:587
#   - Mailgun:    smtp.mailgun.org:587
#
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password_here
ALERT_EMAIL=soc-alerts@yourdomain.com


# =============================================================================
# MAXMIND GEOIP - GEOGRAPHIC ENRICHMENT (OPTIONAL)
# =============================================================================
# Local GeoIP database for IP geolocation
#
# Note: Cloudflare headers (CF-IPCountry, CF-IPCity) provide this for web
#       traffic. MaxMind is useful for non-Cloudflare sources (Suricata, etc.)
#
# Get free license key:
#   1. Create account: https://www.maxmind.com/en/geolite2/signup
#   2. Generate key: Account → Manage License Keys → Generate New Key
#
# Databases (auto-downloaded by geoipupdate):
#   - GeoLite2-City.mmdb
#   - GeoLite2-Country.mmdb
#   - GeoLite2-ASN.mmdb
#
MAXMIND_LICENSE_KEY=your_maxmind_license_key_here
MAXMIND_ACCOUNT_ID=your_maxmind_account_id_here


# =============================================================================
# AUTOMATION SETTINGS
# =============================================================================

# Timezone for watch schedules and log timestamps
# Used by digest.py for morning (0600) and evening (1800) reports
TZ=America/New_York

# Auto-blocking threshold (AbuseIPDB confidence score)
# Only IPs with score >= this value will be auto-blocked at Cloudflare
#
# Recommended thresholds:
#   - 90: Conservative (confirmed malicious only) [DEFAULT]
#   - 80: Moderate (includes high-risk IPs)
#   - 70: Aggressive (may catch some false positives)
#
BLOCK_THRESHOLD=90

# Minimum abuse reports required before auto-blocking
# Prevents blocking IPs with high score but few reports (possible false positive)
MIN_REPORTS=5


# =============================================================================
# ML SCORING (OPTIONAL)
# =============================================================================
# Machine learning threat detection settings
# See docs/ml-detection.md for full documentation
#
# Model path inside container (relative to /app)
ML_MODEL_PATH=models/ground_truth_v2_xgb_20260127_171501

# ML score threshold for "malicious" verdict
# Requests scoring above this are flagged for review/blocking
ML_THRESHOLD=0.7

# Enable/disable ML scoring (useful for debugging)
ML_ENABLED=true


# =============================================================================
# DEVELOPMENT / DEBUG
# =============================================================================
# Settings for development and troubleshooting

# Log level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# Dry run mode: Set to true to test without making changes
# - enrichment.py: Query AbuseIPDB but don't write to OpenSearch
# - autoblock.py: Identify IPs but don't block at Cloudflare
DRY_RUN=false

# Rate limiting for API calls (requests per minute)
# Lower values are safer for free tier APIs
API_RATE_LIMIT=60
